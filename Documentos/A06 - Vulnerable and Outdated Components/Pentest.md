# **Índice**

<span style="color:black;">1. [ Enumeración](#Enumeración)</span><br>
<span style="color:black;">2. [ Buscar vulnerabilidades](#Vulnerabilidades)</span><br>
<span style="color:black;">3. [ Acceso a la máquina](#acceso1)</span><br>
<span style="color:black;">4. [ Flag de usuario normal](#Flag1)</span><br>
<span style="color:black;">5. [ Escalada de privilegios a Root](#Escalada)</span><br>
<span style="color:black;">6. [ Flag de Root](#flag-root)</span><br>
---

<br>




<h1 name="Enumeración">1. Enumeración</h1>

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/nmap.png" alt="nmap">

> nmap 172.17.0.2 -sV

Al hacer un nmap podremos encontrar diferentes puertos abiertos con servicios en ejecución: ftp en el puerto 21 con la versión 3.0.5 de vsftpd, SSH en el puerto 22, Apache por el puerto 80, Apache Jserv por el puerto 8009 y Apache Tomcat por el 8080 con la versión 9.0.30.

<br>

<h1 name="Vulnerabilidades">2. Buscar vulnerabilidades</h1>
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/tu1millon-web.png" alt="tu1millon web">

Si accedemos a la IP de la máquina nos encontramos con el login de la web de Llados, parece que estamos ante un posible fan o alguien que se hace pasar por él.
<br>

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/searchsploit.png" alt="searchsploit">

Podemos hacer un searchsploit de todos los servicios y sus respectivas versiones para buscar si tienen algún exploit. En este caso no encontramos absolutamente nada así que tocará empezar a buscar de otra forma.

<br>

Si buscamos la versión de Tomcat directamente en Google podemos acceder a múltiples exploits que explotan el [CVE-2020-1938](https://github.com/00theway/Ghostcat-CNVD-2020-10487).
Si nos aprovechamos de esta vulnerabilidad podremos leer archivos que estan dentro del servidor Tomcat.

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/tomcat-exploit.png" alt="Tomcat exploit">

<br>

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/lecturaweb_xml.png" alt="Lectura web XML AJPshooter">

Al ejecutar el script de python de ajpShooter podremos leer el archivo web.xml. En este archivo podemos observar que hay unas credenciales.
> pepe:a25kaDE4MzZhYg==

Parece ser que tenemos la contraseña del usuario *pepe* codificada en base64. Vamos a intentar descodificarla.


<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/cyberchef.png" alt="CyberChef">

Accedemos a [CyberChef](https://gchq.github.io/CyberChef/) y obtenemos la contraseña real. Ahora sabemos que el usuario *pepe* tiene la contraseña *kndh1836ab*


<h1 name="acceso1">3. Acceso a la máquina</h1>

Con las credenciales adquiridas de pepe accedermos a la maquina utilizando ssh.

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/ssh-pepe.png" alt="SSH pepe">

<br>

<h1 name="Flag1">4. Flag de usuario normal</h1>

Una vez hemos accedido como pepe podremos encontrar la primera flag **user.txt** en su home.

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/user-flag.png" alt="user.txt">

<br>

<h1 name="Escalada">5. Escalada de privilegios a Root</h1>

Despues de investigar la maquina no encontramos ninguna debilidad de forma manual, asi que usaremos la herramientoa linpeas para hacer una busqueda automatica de las posibles vulnerabilidades.

<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/wget-linpeas.png" alt="linpeas.sh">
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/linpeas.png" alt="GTFOBins vim">

Revisando la salida del script podemos ver que pepe puede ejecutar el binario vim utilizando **sudo** sin necesidad de contraseña
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/linpeas-vim.png" alt="linpeas vim">

Si realizamos una busqueda en GTFOBins podremos encontrar una manera de aprovechar esta vulnerabilidad, [GTFOBins vim](https://gtfobins.github.io/gtfobins/vim/).

<br>
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/gtfobins_vim_sudo.png" alt="GTFOBins vim sudo">

Si aplicamos el comando encontrado en GTFOBins podremos generar una shell con el usuario root.
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/escaladaaroot2.png" alt="escalada a root con vim">
<br>
<h1 name="flag-root">6. Flag de Root</h1>

Para encontrar la flag **root.txt** usaremos el comando find para registrar el directorio /root
<img src="https://github.com/Dani-ITB24/Proyecto-Final/raw/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Assets/A06%20-%20Componentes%20desactualizados/Img/findroot.txt.png" alt="Find de root.txt">

