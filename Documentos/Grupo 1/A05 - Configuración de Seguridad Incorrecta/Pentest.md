# Grupo 4: Fallas en el Software y en la Integridad de los Datos

## **Índice**

<span style="color:black;">1. [ Enumeración](#Enumeración)</span><br>
<span style="color:black;">2. [ Buscar vulnerabilidades](#Vulnerabilidades)</span><br>
<span style="color:black;">3. [ Flag user.txt](#Flag1)</span><br>
<span style="color:black;">4. [ Escalada de privilegios a Root y flag de root](#root)</span><br>
<span style="color:black;">5. [ Escalada de privilegios a Root y flag de root](#valoracion)</span><br>

---




## Preparación de maquina
Para preparar la maquina realizaremos un pull de la imagen de DockerHub, y la pondremos en marcha.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/docker_pull.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/docker_run.png)

<h1 name="Enumeración">1. Enumeración</h1>

Para poder descubrir la IP de la maquina usaremos el cando arp el cual nos muestra la tabla arp. Podemos ver que existe una IP en la interfaz **docker0** \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/4ee70046b11d4fb56a7fc04c6cf76312beaec8d4/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/arp-a.png) \
Realizaremos una busqueda de puertos y directorios web que pueda tener la maquina, para ello usaremos nmap y dirb. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/nmap.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/dirb.png) \

<h1 name="Vulnerabilidades">2. Buscar vulnerabilidades</h1>

Descubrimos que la maquina tiene un servidor FTP, nos conectamos para buscar algun tipo de pista o contraseña.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/ftp.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/ls_ftp.png) \
Encontramos escondido un fichero llamado **cred.txt**. Lo guardamos ya que de momento no podemos hacerle uso. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/get_cred.png) \
Buscaremos dentro de la web de la maquina para ver si encontramos alguna vulnerabilidad.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/index.png)
La pagina parece ser una landing page basica, asi que navegamos al directorio **/css** que encontramos con dirb. Dentro hay varios ficheros .css, en uno de ellos encontramos la pista **Cuando puedas mirate las notas.md**.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/css.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/pista1.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/notas.png) \
En las notas descubrimos que hay un usuario llamado **Maya** y ademas encontramos una foto llamada **foton.jpg** \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/notas_texto.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/foton.png) \
Una vez conseguimos la foto usaremos la utilidad **steghide** para poder descubrir si hay información oculta dentro de ella. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/steghide.png) \
Conseguimos extraer un .zip, para poder descomprimirlo usaremos la utilidad zip2jhon para poder generar una hash que la utilidad john pueda entender y seguido de eso descifraremos la contraseña.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/zip2john.png)
Una vez descubierta la contraseña, **brasil**, descomprimimos el .zip, el cual nos dice que hay un panel de control ubicado en **/wcontrol**
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/john.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/unzip.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/wcontrol.png) \
Usaremos las credenciales descubiertas a traves del FTP para acceder. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/cat_cred.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/cyberchef.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/wcontrol_dashboard.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/wcontrol_otros.png) \
Investigando la pagina descubrimos un apartado en el que se nos muestra una saldi de un comando.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/wcontrol_ejecutar.png) \
Si interceptamos la peticion podemos comprobar que el comando que se realiza al servidor es **service apache2 status**.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/burpsuite_intercept.png) \
Realizando pruebas podemos ver que utilizando el programa **burpsuite**, podemos ejecutar comandos en la maquina.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/repeater_ls.png) \
Sin embargo no nos permite realizar una reverse shell via comando.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/burpsuite_reverseshell.png) \
Para poder conectarnos a la maquina pondremos en marcha un servidor basico apache en el que estara alojada nuestra reverse shell, y realizaremos la descarga utilizando curl, de esta forma el archivo **shell.php** estara en la maquina. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/php-reverseshell.png) \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/python3-http.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/curl-reverse.png) \
Una vez subido el archivo pondremos nuestro equipo en escucha y ejecutaremos el archivo shell.php. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/google-shell.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/acceso-maquina.png) \
Una vez hemos accedido a la maquina realizamos una busqueda para ver si encontramos algun archivo que tenga el permiso **SUID**. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/find4000.png) \
Encontramos un fichero con un nombre sospechoso **abejamaya**.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/abejamaya.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/cat_abeja.png) \
Despues de inspeccionar este fichero descubrimos que guarda algun tipo de pista en formato hexadecimal en la foto **bee.jpg**. Para poder ver el contenido de la foto usamos la utilidad **xxd** que nos permite generar una representación hexadecimal y ASCII del archivo. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/xxd-bee.png) \
En el fichero tenemos una pista que indica el numero **0000020** y **Base85**, si copiamos la cadena hexadecimal numero 20 y la pasamos por el cyberchef utilizando tambien Base85, descubrimos la frase **Maya_es_la_m**, la cual podria ser una contraseña. \
<h1 name="Flag1">3. Flag user.txt</h1>

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/cyberchef-bee.png) \
Si utilizamos la contraseña adquirida podremos acceder como **bumblebee**. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/su-bumblebee.png) \
En la home de bumblebee encontramos la flag **user.txt**, y una clave privada SSH, que pertenece al segundo usuario **Maya**. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/user.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/file.png) \
Utilizando ssh2john generamos una hash que la utilidad john pueda entender y seguido de eso descifraremos el **passphrase** de la clave privada, **honeybee**. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/ssh2john.png) 
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/john2.png) \
Nos conectaremos via SSH al usuario maya utilizando la clave privada. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/ssh-i.png) \

<h1 name="root">4. Escalada de privilegios a Root y flag de root</h1>

En el home de maya encontramos un archivo oculto llamado **wget_disabled** que contiene el permiso SUID.
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/ls-maya.png) \
Si realizamos una busqueda en GTFOBins encontraremos un metodo para aprovecharnos de esta vulnerabilidad. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/gtfobins.png)
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/root.png) \
Una vez hemos accedo como root encontraremos la flag **root.txt**, en /root. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/d7a1d4f4e12a2379bf12692ef264463613c0b672/Documentos/Grupo%201/A05%20-%20Configuraci%C3%B3n%20de%20Seguridad%20Incorrecta/Assets/root-flag.png)

<h1 name="valoracion">5. Valoración</h1>
Creo que la maquina esta muy bien lograda, muy enrevesada en algunos momentos pero las pistas ayudaban bastante, creo que se ha aplicado la vulnerabilidad correctamente y ademas se puede realizar utilizando conocimientos que hemos adquirido durante el curso.
