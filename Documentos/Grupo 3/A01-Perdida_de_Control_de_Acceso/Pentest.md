# Grupo 3: Perdida de Control de Acceso

## **Índice**

<span style="color:black;">1. [ Enumeración](#Enumeración)</span><br>
<span style="color:black;">2. [ Buscar vulnerabilidades](#Vulnerabilidades)</span><br>
<span style="color:black;">3. [ Escalada de privilegios a Root ](#root)</span><br>
<span style="color:black;">4. [ Perdida de Control de Acceso ](#perdida)</span><br>
<span style="color:black;">4. [ Valoración](#valoracion)</span><br>

---



## Preparación de maquina

Para poner el servidor el marcha tendremos que descargar el Github del grupo3. Una vez descargado descomprimimos el .zip y nos dirigiremos al directorio **A01-Perdida_de_Control_de_Acceso**. \

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/wget.png) \
Dentro del directorio instalaremos la version necesaria de docker-compose. \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/install-dockercompose.png) \
Para activar el servidor ejecutamos **sudo docker-compose up** \
![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/docker-compose.png) 

<h1 name="Enumeración">1. Enumeración</h1>

Para encontrar la IP del servidor utilizaremos la utilidad **arp** 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/arp.png) 

Una vez descubierta la IP **172.18.0.3**, realizaremos un nmap, encontramos varios puertos **http** abiertos. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/nmap.png) 

Usaremos **dirb** para descubrir los directorios web del servidor, pero no encontramos nada. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/dirb.png)

<h1 name="Vulnerabilidades">2. Buscar vulnerabilidades</h1>

Si nos dirigimos al puerto encontrado en la salida del nmap encontraremos una web llamada **traefik**, la cual tiene alojadas varias webs, la primera que encontramos esta en al dirección **172.18.0.4:80** donde encontramos, una pagina secreta de admin. En la dirección 172.18.0.5, encontramos una landing page en la que parece no haber nada.

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/dashboard.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/server.4.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/admin-secret-web.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/pino-php.png) \
Investigamos la web secreta y encontramos un login, en el cual podemos regenerar la contraseña de un usuario, si probamos a hacerlo con datos random, conseguimos un panel **shrek-master** en el que podemos enviar comandos al servidor. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/login.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/regenerar-contrase%C3%B1a.png) 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/shrek-master.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/command-panel.png)  \
Si interceptamos la petición al servidor podemos ver que hay ciertos comandos deshabilitados, ademas parece que hay una cárcel **/JAIL** que nos impide realizar los comandos, para ello tendremos que escapar la ejecución. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/burpsuite.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/ls.png)

Despues de realizar varias pruebas vemos que podemos escapar los comandos añadiendo **&&** al final. Ejecutaremos una reverse shell con python3. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/reverse-shell-web.png) 

Conseguimos acceso a la maquina con el usuario **www-data**. Para realizar la escalada a root tendremos que usar la utilidad find para poder encontrar el binario con **SUID**, en este caso es **python3.9** 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/nc-whoami-find.png)

<h1 name="root">3. Escalada de privilegios a Root</h1>

Si buscamos en GTFOBins encontraremos una forma de aprovecharnos de esta vulnerabilidad para poder generar una shell como root, en nuestro caso habra´´a que especificar la version de python. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/root.png) \
Investigando la maquina encontramos un archivo config.php con unas credenciales de una base de datos. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/config-php.png)

<h1 name="perdida">4. Perdida de Control de Acceso</h1>
Usaremos las credenciales encontradas para poder acceder a la base de datos del servidor. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/mysql.png) 

Encontramos una tabla llamada **people**, dentro hay un usuario llamado **shrek-master** con la contraseña **stephisgood_2007**, cambiaremos esta contraseña de esta forma el administrador de la web perdara su acceso. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/tables.png)

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/cambiada.png)

Si accedemos a la web encontrada podremos hacer login con las credenciales que hemos modificado. 

![](https://github.com/Dani-ITB24/Proyecto-Final/blob/Grupo5(Eloi-Alan-Fernando-Jose-Zome%C3%B1o)/Documentos/Grupo%203/A01-Perdida_de_Control_de_Acceso/Assets/acces-psswd.png)

<h1 name="valoracion">5. Valoración</h1>

La máquina está mal planteada pero faltan ambas flags, user.txt y root.txt, ponerla en marcha ha sido difícil para cualquiera que no tenga experiencia en docker, la escalada a root es bastante simple, pero la parte de encontrar y cambiar la contraseña le suma dificultad.


